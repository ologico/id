---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <button id="login-btn">Login</button>
  <div id="result"></div>

  <script>
    import { login } from "../util/tools.ts";

    const button = document.getElementById("login-btn");
    const resultDiv = document.getElementById("result");

    button.addEventListener("click", async () => {
      // get the first credential stored
      const storageKey = "webauthn:id:";
      const keys = Object.keys(localStorage).filter((k) =>
        k.startsWith(storageKey)
      );

      if (keys.length === 0) {
        resultDiv.textContent = "No credential found in this browser.";
        return;
      }

      const credId = keys[0].replace(storageKey, "");

      const result = await login(credId); // pass credId into login()
      resultDiv.textContent = result;
    });
  </script>
</Layout>
